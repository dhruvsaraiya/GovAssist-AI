<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Aadhaar Update (Demo)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display:block; margin-top:10px; font-weight:600; }
    input, select { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; }
    .row { display:flex; gap:8px; }
    .half { flex:1; }
    button { margin-top:16px; padding:10px 14px; }
  </style>
</head>
<body>
  <h1>Aadhaar Update (Demo)</h1>
  <form id="aadhaarForm">
    <label for="applicant_name">Applicant name</label>
    <input id="applicant_name" name="applicant_name" />

    <label for="father_name">Father's name</label>
    <input id="father_name" name="father_name" />

    <label for="date_of_birth">Date of birth</label>
    <input type="date" id="date_of_birth" name="date_of_birth" />

    <label for="gender">Gender</label>
    <select id="gender" name="gender">
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>

    <label for="address_line1">Address line 1</label>
    <input id="address_line1" name="address_line1" />

    <label for="city">City</label>
    <input id="city" name="city" />

    <label for="state">State</label>
    <input id="state" name="state" />

    <label for="pin_code">PIN code</label>
    <input id="pin_code" name="pin_code" />

    <label for="mobile">Mobile</label>
    <input id="mobile" name="mobile" />

    <label for="email">Email</label>
    <input id="email" name="email" />

    <button type="button" onclick="alert('Submitted (demo)')">Submit</button>
  </form>

  <script>
    // Expose a helper to be called by injected JS from WebView
    window.fillForm = function(mapping) {
      try {
        for (const k in mapping) {
          const el = document.getElementById(k) || document.querySelector('[name="' + k + '"]');
          if (!el) continue;
          if (el.tagName === 'SELECT') {
            el.value = mapping[k];
          } else {
            el.value = mapping[k] || '';
          }
          el.dispatchEvent(new Event('input', { bubbles: true }));
        }
        return { ok: true };
      } catch (e) {
        return { ok: false, error: String(e) };
      }
    };

    // Listen for individual field updates from parent frame
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'UPDATE_FIELD') {
        console.log('Received field update:', event.data.fieldId, event.data.value);
        const el = document.getElementById(event.data.fieldId) || document.querySelector('[name="' + event.data.fieldId + '"]');
        if (el) {
          if (el.tagName === 'SELECT') {
            el.value = event.data.value;
          } else {
            el.value = event.data.value;
          }
          el.dispatchEvent(new Event('input', { bubbles: true }));
          el.dispatchEvent(new Event('change', { bubbles: true }));
          console.log('Field updated successfully:', event.data.fieldId);
          
          // Highlight the field temporarily to show it was updated
          el.style.backgroundColor = '#e6f3ff';
          setTimeout(function() {
            el.style.backgroundColor = '';
          }, 1000);
        } else {
          console.warn('Element not found for field:', event.data.fieldId);
        }
      }
    });
  </script>
</body>
</html>